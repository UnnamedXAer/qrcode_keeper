name: Build & Release

on: 
  push: # after successfully merged pull request the push is executed.
    branches:
      - staging
      - production

jobs:
  call-build-workflow:
    name: "Calling Build & Release reusable workflow"
    uses: ./.github/workflows/build_release.yml
    with:
      flavor: $GITHUB_REF_NAME
      tag-suffix: -stag
    secrets:
      token: ${{ secrets.TOKEN }}
  # 



#########################################################
# name: Build & Release

# on: 
#   pull_request:
#     branches:
#       - staging

#   push:
#     branches:
#       - staging

# jobs:
#   build:
#     name: Build & Release
#     runs-on: ubuntu-latest
#     steps:
#       - uses: actions/checkout@v1
#       - uses: actions/setup-java@v1
#         with:
#           java-version: '12.x'
#       - uses: subosito/flutter-action@v1
#         with:
#           flutter-version: '3.3.3'
#       - run: flutter pub get
#       # - run: flutter test
#       - run: flutter pub run flutter_native_splash:create --flavor staging
#       - run: flutter pub run flutter_launcher_icons:main -f "flutter_launcher_icons-staging.yaml"
#       - run: flutter build apk --split-per-abi "--release" --flavor staging -t "lib/main_stag.dart"
#       - name: Push to Releases
#         uses: ncipollo/release-action@v1
#         with:
#           artifacts: "build/app/outputs/apk/staging/release/*"
#           tag: v1.0.${{ github.run_number }}
#           token: ${{ secrets.TOKEN }}